---
export const prerender = true
import Layout from '@/layouts/Layout.astro'
import { getAttributeGroupById, mapNonExemptAttributeGroupsInTree } from '@/schema/attribute-groups'
import { CriteriaPage } from './criteria'
import { isValidSoftwareWalletName, softwareWallets } from '@/data/software-wallets'
import { hardwareWallets, isValidHardwareWalletName } from '@/data/hardware-wallets'
import { representativeWalletForType } from '@/data/wallets'
import {
	mapWalletTypes,
	urlSlugToWalletType,
	walletTypeToUrlSlug,
	WalletType,
} from '@/schema/wallet-types'

export const getStaticPaths = () => {
	return [
		...Object.values(
			mapWalletTypes(walletType =>
				mapNonExemptAttributeGroupsInTree(
					representativeWalletForType(walletType).overall,
					attr => ({
						params: {
							type: walletTypeToUrlSlug(walletType),
							criteria: attr.id,
						},
					}),
				),
			),
		).flat(1),
		// Redirects
		...Object.values(softwareWallets).map(wallet => ({
			params: {
				type: walletTypeToUrlSlug(WalletType.SOFTWARE),
				criteria: wallet.metadata.id,
			},
		})),
		...Object.values(hardwareWallets).map(wallet => ({
			params: {
				type: walletTypeToUrlSlug(WalletType.HARDWARE),
				criteria: wallet.metadata.id,
			},
		})),
	]
}
const { criteria, type } = Astro.params

// if is wallet or hardware wallet redirect to projects/[walletName]
const isWallet = isValidHardwareWalletName(criteria) || isValidSoftwareWalletName(criteria)

if (isWallet) {
	return Astro.redirect('/' + type + `/projects/${criteria}`)
}

const walletType = urlSlugToWalletType(type)

if (walletType === null) {
	return Astro.redirect('/')
}

const attrGroup = getAttributeGroupById(criteria, representativeWalletForType(walletType).overall)

if (attrGroup === null) {
	throw new Error('Invalid attribute group')
}
---

<Layout
	metadata={{
		title: `${attrGroup.displayName} - Walletbeat`,
		description: `Learn how ${attrGroup.displayName} impacts your wallet experience.`,
		keywordsBefore: [`Ethereum ${attrGroup.displayName}`],
	}}
>
	<CriteriaPage walletType={walletType} attrGroupId={criteria} client:load />
</Layout>
